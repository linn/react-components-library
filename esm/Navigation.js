import e,{useState as t,Fragment as o}from"react";import r from"@material-ui/core/Button";import i from"prop-types";import{h as n,a}from"./chunk-24be6bba.js";import c from"@material-ui/core/Typography";import l from"@material-ui/core/Paper";import s from"@material-ui/core/styles/withStyles";import m from"@material-ui/core/List";import u from"@material-ui/core/ListItem";import p from"@material-ui/core/Grid";import f from"@material-ui/icons/Close";import d from"./utilities.js";import"redux-api-middleware";import"./chunk-2aea02a5.js";import g from"./fetchNews.js";import h from"./markNotificationSeen.js";import E from"./fetchMenu.js";import y from"./menuSelectors.js";import b from"./newsSelectors.js";import k from"./getUsername.js";import x from"./initialiseOnMount.js";import{connect as S}from"react-redux";import{withRouter as v}from"react-router";import N from"@material-ui/core/Tabs";import w from"@material-ui/core/Tab";import C from"@material-ui/core/AppBar";import I from"@material-ui/core/ClickAwayListener";import R from"@material-ui/core/Menu";import T from"@material-ui/core/MenuItem";import B from"@material-ui/core/Toolbar";import L from"@material-ui/core/Badge";import{useSnackbar as j}from"notistack";import O from"@material-ui/icons/AccountCircle";import q from"@material-ui/icons/Notifications";var z={listItemText:{"&:first-child":{paddingLeft:30,paddingTop:0,paddingBottom:0}},paper:{backgroundColor:"#f5f5f5",position:"relative",zIndex:-1},menuItems:{fontSize:"12px",lineHeight:2},closeButton:{marginRight:"10px",marginTop:"10px",position:"absolute",top:0,right:0,zIndex:1}};function M(t){var o=t.section,i=t.classes,n=t.close,a=o.columns;return e.createElement(l,{classes:{root:i.paper}},e.createElement(r,{onClick:n,color:"secondary",style:z.closeButton},e.createElement(f,null)),e.createElement(p,{container:!0,justify:"flex-start"},a.map(function(t,o){return e.createElement(p,{item:!0,xs:12,sm:6,md:4,lg:3,xl:3,key:o},t.categories.filter(function(e){return e.items.filter(function(e){return e.showInMenu}).length>0}).map(function(t){return e.createElement(m,{key:t.title},e.createElement(u,null,e.createElement(c,{variant:"button",gutterBottom:!0},t.title.replace("&amp;","&"))),t.items.map(function(t){return e.createElement("div",{key:t.href},t.showInMenu&&e.createElement("a",{href:t.href,style:{textDecoration:"none"}},e.createElement(u,{classes:{root:i.listItemText},button:!0},e.createElement(c,{variant:"overline",classes:{overline:i.menuItems},color:"primary"},t.title))))}))}))}),e.createElement(p,{item:!0,xs:12},e.createElement("a",{href:"/".concat(o.id)},e.createElement(r,{onClick:n,color:"primary",style:{marginRight:"10px",marginBottom:"10px",float:"right"}},"SHOW ALL OPTIONS...")," "))))}M.propTypes={classes:i.shape({}).isRequired,section:i.shape({}).isRequired,close:i.func.isRequired};var A=s(z)(M);function P(i){var n=i.classes,l=i.sections,s=i.loading,m=i.username,u=i.myStuff,f=i.seenNotifications,g=i.unseenNotifications,h=i.markNotificationSeen,E=i.authRoot,y=t(!1),b=a(y,2),k=b[0],x=b[1],S=t(),v=a(S,2),z=v[0],M=v[1],P=j(),D=P.enqueueSnackbar,H=P.closeSnackbar;if(l){var U=l.map(function(e){return e.id}),G=function(){M()};return e.createElement(o,null,e.createElement(I,{onClickAway:function(){return x(!1)}},e.createElement("div",{className:n.root},l&&!s&&e.createElement(C,{position:"static",classes:{root:n.appBar}},e.createElement(B,{classes:{gutters:n.toolbar}},e.createElement(p,{container:!0,alignItems:"center",justify:"space-between",spacing:3,classes:{container:n.container}},e.createElement(p,{item:!0,xs:10},e.createElement(N,{classes:{root:n.tabs},value:k,onChange:function(e,t){x(k!==t&&t)},scrollButtons:"auto",variant:"scrollable",indicatorColor:"primary",textColor:"primary"},l.map(function(t){return e.createElement(w,{id:t.id,key:t.id,classes:{root:n.tab},label:e.createElement("span",{className:n.tabLabel},t.title),selected:!1})}))),e.createElement(p,{item:!0,xs:1},e.createElement(c,{variant:"h4"},e.createElement(O,{"aria-owns":z?"simple-menu":void 0,onClick:function(e){M(e.currentTarget)},id:l.length,key:l.length}))),e.createElement(p,{item:!0,xs:1},e.createElement(c,{variant:"h4"},e.createElement(L,{badgeContent:g?g.length:0,color:"primary",variant:"dot"},e.createElement(q,{onClick:function(){!f&&!g||f.length+g.length===0?D("No notifications to show!",{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"info",preventDuplicate:!0}):g.concat(f).forEach(function(t,i){setTimeout(function(){D("".concat(t.title," ").concat(t.content),{anchorOrigin:{vertical:"bottom",horizontal:"right"},ContentProps:{classes:{root:localStorage.getItem(t.title)?n.snackbarSeen:n.snackbarNew}},action:function(i){return function(t,i){return e.createElement(o,null,e.createElement(r,{variant:"contained",onClick:function(){window.location=d.getSelfHref(i)}},"View"),e.createElement(r,{onClick:function(){H(t),localStorage.setItem(i.title,i.content),h(i)}},"Dismiss"))}(i,t)},preventDuplicate:!0})},200*i)})}})))),e.createElement(R,{id:"simple-menu",anchorEl:z,open:Boolean(z),onClose:G},e.createElement(T,{onClick:G},m),m&&u.groups.map(function(t){return e.createElement("span",null,e.createElement("a",{href:t.items[0].href},e.createElement(T,{onClick:G},t.items[0].title)))}),e.createElement(T,{onClick:function(){window.location.assign("".concat(E,"account/logout"))}},"Sign Out"))))),U.map(function(t,o){return k===o&&e.createElement(A,{key:t,section:l.find(function(e){return e.id===t}),id:t,style:{align:"right"},anchorEl:t.id,close:function(){return x(!1)}})}))))}return e.createElement("div",{className:n.root},e.createElement(C,{position:"static",color:"default"},e.createElement(B,{classes:{gutters:n.toolbar}})))}P.propTypes={classes:i.shape({}).isRequired,sections:i.arrayOf(i.shape({})),history:i.shape({}).isRequired,loading:i.bool,username:i.string,myStuff:i.shape({}),seenNotifications:i.arrayOf(i.shape({})),unseenNotifications:i.arrayOf(i.shape({})),markNotificationSeen:i.func.isRequired,authRoot:i.string.isRequired},P.defaultProps={sections:null,myStuff:null,seenNotifications:[],unseenNotifications:[],loading:!1,username:""};var D=s(function(e){return{root:{position:"absolute",width:"100%",top:0,zIndex:10},tabLabel:{fontSize:e.typography.fontSize,color:e.palette.grey[200]},snackbarNew:{background:e.palette.primary.dark,width:"800px"},snackbarSeen:{width:"800px"},panel:{position:"relative"},menuButton:{marginLeft:-12,marginRight:20},tab:n({},e.mixins.toolbar,{minWidth:"100px"}),toolbar:{paddingLeft:0,paddingRight:0},tabs:n({},e.mixins.toolbar,{paddingLeft:40}),container:{width:"100%"},appBar:{backgroundColor:e.palette.grey[800]}}})(P),H=window.APPLICATION_SETTINGS,U=n({},{appRoot:""},H),G=v(S(function(e){return{sections:y.getSections(e),myStuff:y.getMyStuff(e),username:k(e),loading:y.getMenuLoading(e),seenNotifications:b.getSeenNotifications(e),unseenNotifications:b.getUnseenNotifications(e),authRoot:U.authorityUri}},{initialise:function(e){return function(t){t(E(e,U.proxyRoot)),t(g(e,U.proxyRoot))}},markNotificationSeen:h})(x(D)));export default G;
